// Generated by CoffeeScript 1.4.0
var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

define(['shipShape', 'Translator', 'collisionDetect'], function(shipShape, Translator, collisionDetect) {
  var ShipState;
  return ShipState = (function() {

    function ShipState(settings) {
      this.settings = settings;
      this.takeOff = __bind(this.takeOff, this);

      this.land = __bind(this.land, this);

      this.engineRotatedPoints = __bind(this.engineRotatedPoints, this);

      this.externalBoxPoints = __bind(this.externalBoxPoints, this);

      this.liveNosePoint = __bind(this.liveNosePoint, this);

      this.liveEnginePoint = __bind(this.liveEnginePoint, this);

      this.livePoints = __bind(this.livePoints, this);

      this.shootOn = __bind(this.shootOn, this);

      this.thrustOn = __bind(this.thrustOn, this);

      this.changeDirection = __bind(this.changeDirection, this);

      this.velocity = [0, 0];
      this.direction = 0;
      this.position = [0, 0];
      this.thrusting = false;
      this.shooting = false;
      this.mass = 1;
      this.translator = new Translator;
    }

    ShipState.prototype.changeDirection = function(delta) {
      var radFactor;
      if (delta) {
        this.direction += delta;
        radFactor = 2 * Math.PI;
        if (this.direction >= radFactor) {
          this.direction -= radFactor;
        }
        if (this.direction < 0) {
          this.direction += radFactor;
        }
      }
    };

    ShipState.prototype.thrustOn = function(bool) {
      this.thrusting = bool;
    };

    ShipState.prototype.shootOn = function(bool) {
      this.shooting = bool;
    };

    ShipState.prototype.updatePosition = function() {
      var currentAccelerationX, currentAccelerationY, currentForceX, currentForceY;
      currentForceY = this.settings.game.gravity;
      if (this.thrusting) {
        currentForceY += -1 * Math.cos(this.direction) * this.settings.ship.thrustRatio;
      }
      currentForceY += -1 * this.velocity[1] * this.settings.game.viscosity;
      currentAccelerationY = currentForceY * this.mass;
      this.velocity[1] += currentAccelerationY;
      this.position[1] += this.velocity[1];
      currentForceX = 0;
      if (this.thrusting) {
        currentForceX += Math.sin(this.direction) * this.settings.ship.thrustRatio;
      }
      currentForceX += -1 * this.velocity[0] * this.settings.game.viscosity;
      currentAccelerationX = currentForceX * this.mass;
      this.velocity[0] += currentAccelerationX;
      this.position[0] += this.velocity[0];
    };

    ShipState.prototype.livePoints = function() {
      var point, rotatedPoints;
      rotatedPoints = (function() {
        var _i, _len, _ref, _results;
        _ref = shipShape.points;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          point = _ref[_i];
          _results.push(this.translator.rotate(point[0], point[1], this.direction));
        }
        return _results;
      }).call(this);
      return this.translator.translatePoints(rotatedPoints, this.position);
    };

    ShipState.prototype.liveEnginePoint = function() {
      var rotatedPoint;
      rotatedPoint = this.translator.rotate(shipShape.enginePoints[1][0], shipShape.enginePoints[1][1], this.direction);
      return this.translator.translate(rotatedPoint, this.position);
    };

    ShipState.prototype.liveNosePoint = function() {
      return this.livePoints()[0];
    };

    ShipState.prototype.externalBoxPoints = function() {
      return collisionDetect.externalLimits(this.livePoints());
    };

    ShipState.prototype.engineRotatedPoints = function() {
      var point, rotatedPoints;
      rotatedPoints = (function() {
        var _i, _len, _ref, _results;
        _ref = shipShape.enginePoints;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          point = _ref[_i];
          _results.push(this.translator.rotate(point[0], point[1], this.direction));
        }
        return _results;
      }).call(this);
      return (function() {
        var _i, _len, _results;
        _results = [];
        for (_i = 0, _len = rotatedPoints.length; _i < _len; _i++) {
          point = rotatedPoints[_i];
          _results.push(this.translator.translate(point, this.position));
        }
        return _results;
      }).call(this);
    };

    ShipState.prototype.land = function() {
      this.velocity = [0, 0];
      this.thrusting = false;
      this.direction = 0;
    };

    ShipState.prototype.takeOff = function(bool) {
      this.thrusting = bool;
      if (bool) {
        this.position[1] -= 2;
      }
    };

    return ShipState;

  })();
});
